#:import get_color_from_hex kivy.utils.get_color_from_hex

#:import utils kivy.utils
#:import Factory kivy.factory.Factory
#:import CustomOverFlowMenu __main__.CustomOverFlowMenu

#:set cor_fundo utils.get_color_from_hex('#A9A9A9')
#:set cor_imagebox utils.get_color_from_hex('#F0FFF0')
#:set cor_botoes utils.get_color_from_hex('0288D1')
#:set cor_preta utils.get_color_from_hex('#000000')
#:set cor_branca utils.get_color_from_hex('#FFFFFF')

#:set borda_botoes 1, 1, 1, 1

<GerenciaTelas>:
    Home:
        # ID para chamar a tela Home
        name: "home"
    MyBox:
        # ID para chamar a tela MyBox
        name: "mybox"

#Implementação da tela Home
<Home>:
    name: "home"
    MDFloatLayout
        MDCard:
            pos_hint: {'center_x': .5, 'center_y': .5}
            size_hint: .8, .8

            MDLabel:
                text: "Bem-vindo ao aplicativo de processamento de imagem"
                font_size: 34
                halign: "center"

        MDFillRoundFlatButton:
            icon: "android"
            pos_hint: {'center_x': .5, 'center_y': .3}
            text: "Iniciar"
            on_release: app.root.current = "mybox"

<MyBox>:
    name:"mybox"

    MDBottomNavigation:
        panel_color: get_color_from_hex("0288D1")
        selected_color_background: get_color_from_hex("0288D1")
        text_color_active: 0, 0, 0, 1

        MDBottomNavigationItem:
            name: 'imagem'
            text: 'Imagens'
            icon: 'image'
            ImageScreen:

        MDBottomNavigationItem:
            name: 'video'
            text: 'Vídeo'
            icon: 'play'
            VideoScreen:

        MDBottomNavigationItem:
            name: 'camera'
            text: 'Camera'
            icon: 'camera'
            CameraScreen:


#Implementação da tela de imagem
<ImageScreen>:
    name: "myboxlayoutimage"
    MDBoxLayout:
        orientation:'vertical'
        MDToolbar:
            title:'MyApp'
            use_overflow: True
            id: visualizationbutton
            left_action_items:
                [['delete', lambda x: root.clean_images(), "Limpar Imagens", "Limpar Imagens"],]
            right_action_items:
                [["folder-multiple-image", lambda x: root.select_image(), "Abrir Arquivo", "Abrir Arquivo"],
                ["content-save", lambda x: root.save_images(), "Salvar Imagem", "Salvar Imagem"],
                ["code-json", lambda x: root.select_json(), "Abrir JSON", "Abrir JSON"],
                ["cloud-braces", lambda x: root.save_json(), "Salvar JSON", "Salvar JSON"],
                ["eye", lambda x: root.visualization_spinner(), "Visualizações", "Visualizações"],]

        BoxLayout:
            padding: 20
            spacing: 20
            orientation: "horizontal"

            MDFloatingActionButton:
                icon: "arrow-left"
                id: arrowleftimage1
                pos_hint: {'center_x': .5, 'center_y': .5}
                on_press: root.left_button_image()

            MDCard:
                orientation: "horizontal"
                elevation: 10
                Image:
                    id: my_image
                    source: ""

            MDCard:
                orientation: "horizontal"
                elevation: 10
                Image:
                    id: my_image2
                    source: ""

            MDFloatingActionButton:
                icon: "arrow-right"
                id: arrowrightimage2
                pos_hint: {'center_x': .5, 'center_y': .5}
                on_press: root.right_button_image()

        BoxLayout:
            spacing: 20
            orientation: "horizontal"

            BoxLayout:
                spacing: 20
                orientation: "vertical"

                BoxLayout:
                    spacing: 20
                    padding: 20
                    size_hint: 1, 0.2
                    orientation: "horizontal"

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: processoptionsbutton
                        text: "Processamento"
                        on_release: root.process_spinner()

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: transformationbutton
                        text: "Transformação"
                        on_release: root.transformations_spinner()

                BoxLayout:
                    spacing: 20
                    padding: 10
                    size_hint: 1, 0.25
                    orientation: "horizontal"

                    MDFillRoundFlatButton:
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: removebutton
                        text: "-"
                        on_press: root.list_remove_operations()

                    TextInput:
                        size_hint: 1, .4
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        font_size: 16
                        halign: 'left'
                        id: textlist

                    MDFillRoundFlatButton:
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: addbutton
                        text: "+"
                        on_press: root.list_add_operations()

                BoxLayout:
                    spacing: 20
                    size_hint: 1, 0.55
                    orientation: "horizontal"

                    ScrollView:
                        orientation:'horizontal'
                        MDLabel:
                            id: labeltesteimage
                            text: "Operações:"
                            font_size: 16
                            color: cor_botoes
                            size_hint_y: None
                            height: self.texture_size[1]
                            text_size: self.width, None
                            padding: 20, 20

            BoxLayout:
                spacing: 20
                padding: 10
                orientation: "vertical"

                BoxLayout:
                    spacing: 20
                    padding: 10
                    orientation: "vertical"

                    MDLabel:
                        id: labelsaidaocr
                        text: "Saída do OCR"
                        halign: "center"
                        color: cor_botoes

                    BoxLayout:
                        spacing: 20
                        padding: 10
                        orientation: "horizontal"

                        MDFillRoundFlatButton:
                            width: root.width/4.5
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            id: selectjson
                            text: "Aplicar EasyOCR"
                            on_release: root.apply_easy_ocr_th()

                        MDFillRoundFlatButton:
                            width: root.width/4.5
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            id: selectjson
                            text: "Aplicar Tesseract"
                            on_release: root.apply_tesseract_ocr()

                BoxLayout:
                    spacing: 20
                    padding: 10
                    orientation: "horizontal"

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: processjson
                        text: "Processar JSON"
                        on_release: root.process_json_th()

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: processbutton
                        text: "Processar"
                        on_release: root.process_image()

#Implementação da tela de Vídeos
<VideoScreen>:
    name: "myboxlayoutvideo"
    MDBoxLayout:
        orientation:'vertical'
        MDToolbar:
            title:'MyApp'
            use_overflow: True
            id: visualizationbutton
            left_action_items:
                [['home', lambda x: root.select_video(), "Menu", "Menu"]]
            right_action_items:
                [["folder", lambda x: root.select_video(), "Abrir Arquivo", "Abrir Arquivo"],
                ["content-cut", lambda x: root.save_frame_flag(), "Salvar Frame", "Salvar Frame"],
                ["code-json", lambda x: root.select_json(), "Abrir JSON", "Abrir JSON"],
                ["cloud-braces", lambda x: root.save_json(), "Salvar JSON", "Salvar JSON"],
                ["eye", lambda x: root.visualization_spinner(), "Visualizações", "Visualizações"],]
        #TODO: MUDAR AS FUNÇÕES DESSES BOTÕES

        BoxLayout:
            padding: 20
            spacing: 20
            orientation: "horizontal"
            MDCard:
                elevation: 10
                Image:
                    id: video
                    source: ""
            MDCard:
                elevation: 10
                Image:
                    id: video2
                    source: ""

        BoxLayout:
            spacing: 20
            orientation: "horizontal"

            BoxLayout:
                spacing: 20
                orientation: "vertical"

                BoxLayout:
                    orientation: "horizontal"
                    size_hint: 1, 0.2
                    padding: 20
                    spacing: 10

                    MDFloatingActionButton:
                        icon: "replay"
                        id: replay
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        on_press: root.replay()

                    MDFloatingActionButton:
                        id: play
                        icon: "play"
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        on_press: root.play()

                    MDSlider:
                        size_hint: (20, 1)
                        id: timeSlider
                        value: 0.0
                        max: 0.0
                        min: 0.0
                        step: 1
                        color: "0288D1"
                        on_touch_move: root.sider_touch_move()

                    MDLabel:
                        color: cor_preta
                        size_hint: (0.5, 1)
                        text: str(timeSlider.value) + "/" + str(timeSlider.max)

                BoxLayout:
                    size_hint: 1, 0.8
                    spacing: 20
                    orientation: "horizontal"

                    BoxLayout:
                        spacing: 20
                        orientation: "vertical"

                        BoxLayout:
                            spacing: 20
                            padding: 30
                            orientation: "horizontal"

                            MDFillRoundFlatButton:
                                width: root.width/4.5
                                pos_hint: {'center_x': .5, 'center_y': .5}
                                id: processoptionsbutton
                                text: "Processamento"
                                on_release: root.process_spinner()

                            MDFillRoundFlatButton:
                                width: root.width/4.5
                                pos_hint: {'center_x': .5, 'center_y': .5}
                                id: transformationbutton
                                text: "Transformação"
                                on_release: root.transformations_spinner()

                        BoxLayout:
                            spacing: 30
                            padding: 10
                            orientation: "horizontal"

                            MDFillRoundFlatButton:
                                pos_hint: {'center_x': .5, 'center_y': .5}
                                id: removebutton
                                text: "-"
                                on_press: root.list_remove_operations()

                            TextInput:
                                size_hint: 1, .4
                                pos_hint: {'center_x': .5, 'center_y': .5}
                                font_size: 16
                                halign: 'left'
                                id: textlist

                            MDFillRoundFlatButton:
                                pos_hint: {'center_x': .5, 'center_y': .5}
                                id: addbutton
                                text: "+"
                                on_press: root.list_add_operations()

                        BoxLayout:
                            spacing: 20
                            orientation: "horizontal"

                            ScrollView:
                                orientation:'horizontal'
                                MDLabel:
                                    id: labeltesteimage
                                    font_size: 16
                                    size_hint_y: None
                                    height: self.texture_size[1]
                                    text_size: self.width, None
                                    padding: 10, 10

                    BoxLayout:
                        spacing: 20
                        padding: 10
                        orientation: "vertical"

                        BoxLayout:
                            spacing: 20
                            padding: 10
                            orientation: "vertical"

                            MDLabel:
                                id: labelsaidaocr
                                text: "Saída do OCR"
                                halign: "center"
                                color: cor_botoes

                            BoxLayout:
                                spacing: 20
                                padding: 10
                                orientation: "horizontal"

                                MDFillRoundFlatButton:
                                    width: root.width/4.5
                                    pos_hint: {'center_x': .5, 'center_y': .5}
                                    id: selectjson
                                    text: "Aplicar EasyOCR"
                                    on_release: root.apply_easy_ocr()

                                MDFillRoundFlatButton:
                                    width: root.width/4.5
                                    pos_hint: {'center_x': .5, 'center_y': .5}
                                    id: selectjson
                                    text: "Aplicar Tesseract"
                                    on_release: root.apply_tesseract_ocr()


                        BoxLayout:
                            spacing: 20
                            padding: 10
                            orientation: "horizontal"

                            MDFillRoundFlatButton:
                                width: root.width/4.5
                                pos_hint: {'center_x': .5, 'center_y': .5}
                                id: processjson
                                text: "Processar JSON"
                                on_release: root.process_json()

                            MDFillRoundFlatButton:
                                width: root.width/4.5
                                pos_hint: {'center_x': .5, 'center_y': .5}
                                id: processbutton
                                text: "Processar"
                                on_release: root.process_video()

#Implementação da tela de Camera
<CameraScreen>:
    name: "myboxlayoutcamera"
    MDBoxLayout:
        orientation:'vertical'
        MDToolbar:
            title:'MyApp'
            use_overflow: True
            id: visualizationbutton
            left_action_items:
                [['home', lambda x: root.open_camera(), "Menu", "Menu"]]
            right_action_items:
                [["camera", lambda x: root.open_camera(), "Abrir Câmera", "Abrir Câmera"],
                ["content-cut", lambda x: root.save_frame_flag(), "Salvar Frame", "Salvar Frame"],
                ["code-json", lambda x: root.select_json(), "Abrir JSON", "Abrir JSON"],
                ["cloud-braces", lambda x: root.save_json(), "Salvar JSON", "Salvar JSON"],
                ["eye", lambda x: root.visualization_spinner(), "Visualizações", "Visualizações"],]

        BoxLayout:
            padding: 20
            spacing: 20
            orientation: "horizontal"
            MDCard:
                elevation: 10
                Image:
                    id: camera1
                    source: ""
            MDCard:
                elevation: 10
                Image:
                    id: camera2
                    source: ""

        BoxLayout:
            spacing: 20
            orientation: "horizontal"

            BoxLayout:
                spacing: 20
                orientation: "vertical"

                BoxLayout:
                    spacing: 20
                    padding: 20
                    size_hint: 1, 0.2
                    orientation: "horizontal"

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: processoptionsbutton
                        text: "Processamento"
                        on_release: root.process_spinner()

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: transformationbutton
                        text: "Transformação"
                        on_release: root.transformations_spinner()

                BoxLayout:
                    spacing: 20
                    padding: 10
                    size_hint: 1, 0.25
                    orientation: "horizontal"

                    MDFillRoundFlatButton:
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: removebutton
                        text: "-"
                        on_press: root.list_remove_operations()

                    TextInput:
                        size_hint: 1, .4
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        font_size: 16
                        halign: 'left'
                        id: textlist

                    MDFillRoundFlatButton:
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: addbutton
                        text: "+"
                        on_press: root.list_add_operations()

                BoxLayout:
                    spacing: 20
                    size_hint: 1, 0.55
                    orientation: "horizontal"

                    ScrollView:
                        orientation:'horizontal'
                        MDLabel:
                            id: labeltesteimage
                            text: "Operações:"
                            font_size: 16
                            color: cor_botoes
                            size_hint_y: None
                            height: self.texture_size[1]
                            text_size: self.width, None
                            padding: 20, 20

            BoxLayout:
                spacing: 20
                padding: 10
                orientation: "vertical"

                BoxLayout:
                    spacing: 20
                    padding: 10
                    orientation: "vertical"

                    MDLabel:
                        id: labelsaidaocr
                        text: "Saída do OCR"
                        halign: "center"
                        color: cor_botoes

                    BoxLayout:
                        spacing: 20
                        padding: 10
                        orientation: "horizontal"

                        MDFillRoundFlatButton:
                            width: root.width/4.5
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            id: selectjson
                            text: "Aplicar EasyOCR"
                            on_release: root.apply_easy_ocr()

                        MDFillRoundFlatButton:
                            width: root.width/4.5
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            id: selectjson
                            text: "Aplicar Tesseract"
                            on_release: root.apply_tesseract_ocr()


                BoxLayout:
                    spacing: 20
                    padding: 10
                    orientation: "horizontal"

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: processjson
                        text: "Processar JSON"
                        on_release: root.process_json()

                    MDFillRoundFlatButton:
                        width: root.width/4.5
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        id: processbutton
                        text: "Processar"
                        on_release: root.process_image()

<RoundedButton@Button>
    color: cor_preta
    canvas.before:
        Color:
            rgba: cor_botoes
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [48]

<PlayPauseButton@Button>
    background_normal: ''
    background_color: (0, 0, 0, 0)
    font_size: 18
    color: cor_preta
    canvas.before:
        Color:
            rgba: cor_botoes
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [64]

<RoundedSpinner@Spinner>
    background_normal: ''
    background_color: (0, 0, 0, 0)
    font_size: 18
    color: cor_preta
    canvas.before:
        Color:
            rgba: cor_botoes
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [48]



